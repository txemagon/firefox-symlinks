Description: Support building globalmenu-extension from the Firefox source
Author: Chris Coulson <chris.coulson@canonical.com>
Forwarded: not-needed

Index: firefox-trunk-17.0~a1~hg20120809r101850/config/system-headers
===================================================================
--- firefox-trunk-17.0~a1~hg20120809r101850.orig/config/system-headers	2012-08-09 03:05:56.000000000 +0100
+++ firefox-trunk-17.0~a1~hg20120809r101850/config/system-headers	2012-08-11 00:44:01.138753202 +0100
@@ -387,6 +387,10 @@
 LGrafPortView.h
 LHandleStream.h
 libc_r.h
+#ifdef UNITY_GLOBALMENU
+libdbusmenu-glib/server.h
+libdbusmenu-gtk/menuitem.h
+#endif
 libelf.h
 libelf/libelf.h
 libgen.h
@@ -1011,6 +1015,11 @@
 #ifdef MOZ_ENABLE_GIO
 gio/gio.h
 #endif
+#ifdef UNITY_GLOBALMENU
+#ifndef MOZ_ENABLE_GIO
+gio/gio.h
+#endif
+#endif
 #ifdef MOZ_ENABLE_LIBCONIC
 conic/conicconnection.h
 conic/conicconnectionevent.h
Index: firefox-trunk-17.0~a1~hg20120809r101850/configure.in
===================================================================
--- firefox-trunk-17.0~a1~hg20120809r101850.orig/configure.in	2012-08-09 03:05:56.000000000 +0100
+++ firefox-trunk-17.0~a1~hg20120809r101850/configure.in	2012-08-11 00:44:01.142753203 +0100
@@ -8016,6 +8016,20 @@
 AC_SUBST(MOZ_TREE_PIXMAN)
 
 dnl ========================================================
+dnl Dbus-Menu
+dnl ========================================================
+
+UNITY_GLOBALMENU=0
+if test `echo "$MOZ_EXTENSIONS" | grep -c globalmenu` -ne 0; then
+   PKG_CHECK_MODULES(DBUSMENU, dbusmenu-gtk-0.4 gio-2.0)
+   UNITY_GLOBALMENU=1
+   AC_SUBST(DBUSMENU_CFLAGS)
+   AC_SUBST(DBUSMENU_LIBS)
+   AC_DEFINE(UNITY_GLOBALMENU)
+fi
+AC_SUBST(UNITY_GLOBALMENU)
+
+dnl ========================================================
 dnl qcms
 dnl ========================================================
 
Index: firefox-trunk-17.0~a1~hg20120809r101850/js/src/config/system-headers
===================================================================
--- firefox-trunk-17.0~a1~hg20120809r101850.orig/js/src/config/system-headers	2012-08-09 03:08:26.000000000 +0100
+++ firefox-trunk-17.0~a1~hg20120809r101850/js/src/config/system-headers	2012-08-11 00:44:01.142753203 +0100
@@ -387,6 +387,10 @@
 LGrafPortView.h
 LHandleStream.h
 libc_r.h
+#ifdef UNITY_GLOBALMENU
+libdbusmenu-glib/server.h
+libdbusmenu-gtk/menuitem.h
+#endif
 libelf.h
 libelf/libelf.h
 libgen.h
@@ -1011,6 +1015,11 @@
 #ifdef MOZ_ENABLE_GIO
 gio/gio.h
 #endif
+#ifdef UNITY_GLOBALMENU
+#ifndef MOZ_ENABLE_GIO
+gio/gio.h
+#endif
+#endif
 #ifdef MOZ_ENABLE_LIBCONIC
 conic/conicconnection.h
 conic/conicconnectionevent.h
